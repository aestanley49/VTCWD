---
title: "Calibrate SII Model"
author: "Annabelle"
date: "2024-10-02"
output: html_document
---

***Outstanding notes/questions***

- Note, assuming that the population model starts in spring (month when fawns are born)

### Calibration graphs shown 
- Abundance [all, bucks, does, fawns]
- Doe:Fawn ratio 
- Harvest [buck, doe, juvenile, fawn]
- Survival [adult, juvenile, fawn]

Load libraries and files 
```{r}
library(tidyverse)
library(here)

source("../SII_model/functions/popnmodel_func.R")
```

Set parameters
```{r}
params <- list(
  fawn.S.N = 100, juv.f.S.N = 50, juv.m.S.N = 50, ad.f.S.N = 80, ad.m.S.N = 20,
  fawn.E.N = 0, juv.f.E.N = 0, juv.m.E.N = 0, ad.f.E.N = 0, ad.m.E.N = 0,
  juv.f.I.N = 0, juv.m.I.N = 0, ad.f.I.N = 0, ad.m.I.N = 0,
  
  fawn.an.sur = 0.7, juv.f.an.sur = 0.9, juv.m.an.sur = .7, ad.an.f.sur = 0.95, ad.an.m.sur = 0.8, 
  
  juv.repro = 0.4, ad.repro = .9,
  
  hunt.mort.fawn = 0.01, hunt.mort.juv.f = 0.1, hunt.mort.juv.m = 0.2, hunt.mort.ad.f = 0.15, hunt.mort.ad.m = 0.35, 
  
  e.fawn.rate = 0.0, e.ja.rate = 0.0, i.fawn.rate = 0.0, i.ja.rate = 0.0,
  
  env = 0, shedrate = .5, expdecayconstant = .55,
  
  nyears = 50, n0 = 143000
  )
```




```{r}
popfit <- cwd_stoch_model(params)

counts_overtime <- as.data.frame(popfit$counts)

harvest_overtime <- as.data.frame(popfit$removed)
```

notes, these are fractional amounts. need to switch to whole numbers?



#### Abundance [all, bucks, does, fawns]
- Not including juveniles in buck/doe abundance?? 
```{r Abundance for all}
dat.sum <- counts_overtime %>%
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = dat.sum, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Total Abundance", 
       x = "Year", 
       y = "Total Count") 
```

```{r Abundance for all bucks}
dat.sum.bucks <- counts_overtime %>%
  select(matches("ad.m", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = dat.sum.bucks, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Buck Abundance", 
       x = "Year", 
       y = "Total Count") 
```

```{r Abundance for all does}
dat.sum.doe <- counts_overtime %>%
  select(matches("ad.f", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = dat.sum.doe, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Doe Abundance", 
       x = "Year", 
       y = "Total Count") 
```


```{r Abundance for all fawns}
dat.sum.fawn <- counts_overtime %>%
  select(matches("fawn", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = dat.sum.fawn, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Fawn Abundance", 
       x = "Year", 
       y = "Total Count") 
```

#### Doe:Fawn ratio 
```{r}
doe_fawn_ratio <- counts_overtime %>%
  select(matches("ad.f", ignore.case = TRUE), matches("fawn", ignore.case = TRUE)) %>% 
  dplyr::mutate(n_doe = rowSums(across(matches("ad.f", ignore.case = TRUE)), na.rm = TRUE))%>%
    dplyr::mutate(n_fawn = rowSums(across(matches("fawn", ignore.case = TRUE)), na.rm = TRUE))%>%
  dplyr::mutate(doe_fawn = n_doe/n_fawn)%>%
  mutate(year = row_number())

ggplot(data = doe_fawn_ratio, aes(x = year, y = doe_fawn)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
 # geom_hline(yintercept = 1.5, color = "red") + ## This will depend on pop starting size and starting month
  labs(title = "Doe:Fawn Ratio", 
       x = "Year", 
       y = "Total Count")
```




#### Harvest [buck, doe, juv, fawn]

* just a note that if we are going to add complexity to the model, I don't know that the harvest df is set up correctly in the model (would be subject to stochasticity... currently calculated based on a flat rate)

```{r Harvest for all}
harv.sum <- harvest_overtime %>%
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = harv.sum, aes(x = year, y = n)) +
  geom_line() +  
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Total Harvest", 
       x = "Year", 
       y = "Total Count") 
```

```{r Harvest for all bucks}
harv.sum.bucks <- harvest_overtime %>%
  select(matches("ad.m", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = harv.sum.bucks, aes(x = year, y = n)) +
  geom_line() +  
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Buck Harvest", 
       x = "Year", 
       y = "Total Count") 
```

```{r Harvest for all does}
harv.sum.doe <- harvest_overtime %>%
  select(matches("ad.f", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = harv.sum.doe, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Doe Harvest", 
       x = "Year", 
       y = "Total Count") 
```

juveniles

```{r Harvest for all juveniles}
harv.sum.juv <- harvest_overtime %>%
  select(matches("juv", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = harv.sum.juv, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Juveniles Harvest", 
       x = "Year", 
       y = "Total Count") 
```

```{r Harvest for all fawns}
harv.sum.fawn <- harvest_overtime %>%
  select(matches("fawn", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

ggplot(data = harv.sum.fawn, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Fawn Harvest", 
       x = "Year", 
       y = "Total Count") 
```


#### Survival [adult, juv, fawn]

```{r Survival bucks}
dat.sum.bucks <- counts_overtime %>%
  select(matches("ad.m", ignore.case = TRUE)) %>% 
  dplyr::mutate(n = rowSums(across(everything()), na.rm = TRUE))%>%
  mutate(year = row_number())

harv.sum.bucks

ggplot(data = dat.sum.bucks, aes(x = year, y = n)) +
  geom_line() +  
 # geom_hline(yintercept = 143758, color = "red") +
  theme(axis.text=element_text(size=16), axis.title=element_text(size=20))+
  labs(title = "Buck Abundance", 
       x = "Year", 
       y = "Total Count") 
```


